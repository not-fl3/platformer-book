<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Tiled - Platformer book</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../intro.html"><strong aria-hidden="true">1.</strong> Intro</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> Game core</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">2.1.</strong> Game loop</div></li><li class="chapter-item expanded "><a href="../tiled/index.html" class="active"><strong aria-hidden="true">2.2.</strong> Tiled</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.3.</strong> World</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">2.3.1.</strong> Object hierarchy</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.3.2.</strong> Player</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../world/player-state-machine.html"><strong aria-hidden="true">2.3.2.1.</strong> State machine</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.3.2.2.</strong> Cutscene state</div></li><li class="chapter-item expanded "><a href="../world/win-state.html"><strong aria-hidden="true">2.3.2.3.</strong> Win state</a></li><li class="chapter-item expanded "><a href="../world/player-animations.html"><strong aria-hidden="true">2.3.2.4.</strong> Animations</a></li><li class="chapter-item expanded "><a href="../world/tweens.html"><strong aria-hidden="true">2.3.2.5.</strong> Tweens</a></li></ol></li><li class="chapter-item expanded "><a href="../world/spring.html"><strong aria-hidden="true">2.3.3.</strong> Spring</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.3.4.</strong> Special levels</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../water.html"><strong aria-hidden="true">2.3.4.1.</strong> Water</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.3.4.2.</strong> Wind</div></li></ol></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.4.</strong> UI</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">2.4.1.</strong> Main menu</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.4.2.</strong> Ingame settings</div></li></ol></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Juiciness</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../post-effects.html"><strong aria-hidden="true">3.1.</strong> Post processing</a></li><li class="chapter-item expanded "><a href="../screen-reading.html"><strong aria-hidden="true">3.2.</strong> Screen reading shaders</a></li><li class="chapter-item expanded "><a href="../particles-splash.html"><strong aria-hidden="true">3.3.</strong> Particles: Water splash</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.4.</strong> Camera shake</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.5.</strong> Sounds</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> Platforms</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">4.1.</strong> Itch.io, HTML5</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.2.</strong> Steam, PC</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.3.</strong> Play store</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.4.</strong> App store</div></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Platformer book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#tiled" id="tiled">Tiled</a></h1>
<p><a href="https://www.mapeditor.org/">tiled</a> is a free, open source level editor.</p>
<p><code>macroquad-tiled</code> - is an optional part of macroquad responsible for tiled editor integration.</p>
<h1><a class="header" href="#designing-the-world" id="designing-the-world">Designing the world</a></h1>
<p><img src="https://i.imgur.com/cavTcqt.png" alt="screenshot" /></p>
<p><em>This is how the big level made with very basic ideas to what we are going to use here looked in tiled</em></p>
<h1><a class="header" href="#loading-in-macroquad" id="loading-in-macroquad">Loading in macroquad</a></h1>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Load json file exported from tiled
let tiled_map = load_file(&quot;level.json&quot;).await;

// We used some png files in the tiled
// Those pngs are saved alongside with .json, so lets load them as well
let tileset_texture = load_texture(&quot;tileset.png&quot;).await;
let background_texture = load_texture(&quot;background.png&quot;).await;

// And feed all the data loaded to `macroquad-tiled`
let map = tiled::load_map(
    &amp;tiled_map,
    &amp;[
        (&quot;tileset.png&quot;, tileset_texture),
        (&quot;background.png&quot;, background_texture),
    ],
)?;
<span class="boring">}
</span></code></pre></pre>
<h1><a class="header" href="#drawing-tilemaps" id="drawing-tilemaps">Drawing: Tilemaps</a></h1>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Lets draw the whole map full screen
// Default macroquad camera is pixel perfect with (0, 0) in top left corner and (screen_width(), screen_height()) on bottom right
let dest_rect = Rect::new(0., 0., screen_width(), screen_height());

// We used only part of tiled canvas to create our first level
// So lets draw only that part of the canvas
// Area is hardcoded for now, but we will use the technique of drawing parts of tiled canvas
// to jump through level sections in the future
let source_rect = Rect::new(0, 0, 22, 11);

// And just draw our level!
map.draw_tiles(&quot;level&quot;, dest_rect, level.area);
<span class="boring">}
</span></code></pre></pre>
<p>#<img src="https://i.imgur.com/eaKBxeW.png" alt="level" /></p>
<p>It works, we got our nice static background</p>
<h1><a class="header" href="#drawing-sprites" id="drawing-sprites">Drawing: Sprites</a></h1>
<p>Now we got the world rendered, let's add some characters.
We can draw the player right into the tileset and use <code>draw_tiles</code> with different source/destination rects on this part of the tilemap right as we did it for the world.<br />
But <code>macroquad-tiled</code> have some special functions dedicated for sprites drawing.</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl Player {
    // name of the tileset contains player sprites in the tiled map file
    const TILESET: &amp;'static str = &quot;tileset&quot;;
    // sprite number in that tileset
    const PLAYER_TILE: u32 = 11;

    fn draw(&amp;mut self) {
        self.map.spr(
            &quot;tileset&quot;,
            PLAYER_TILE,
            Rect::new(self.pos.x(), self.pos.y(), 8., 8.),
        );
    }
}
<span class="boring">}
</span></code></pre></pre>
<p><img src="https://i.imgur.com/EFHhqP7.gif" alt="player_spr" /></p>
<h1><a class="header" href="#retro-consoles-vibe" id="retro-consoles-vibe">Retro consoles vibe</a></h1>
<p>Now we can draw sprites from tileset and draw the whole maps from the same tileset. 
This actually is pretty close to what we had for game development back into early video console days with hardware sprite controllers!<br />
Also some fantasy consoles like <code>pico-8</code> use very similar video memory model.</p>
<h2><a class="header" href="#paralax" id="paralax">Paralax</a></h2>
<p>In tiled we had two layers - with foreground and background.</p>
<p>First step: draw the background as well:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>self.tiled_map.draw_tiles(&quot;back&quot;, dest_rect, source_rect);
self.tiled_map.draw_tiles(&quot;level&quot;, dest_rect, source_rect);
<span class="boring">}
</span></code></pre></pre>
<p>#<a href="https://i.imgur.com/UTcDaSr.png">level_with_background</a></p>
<p>There is really easy way to add some life to static tiled world: <a href="https://en.wikipedia.org/wiki/Parallax_scrolling">parallax</a> effect.</p>
<p><em>TODO: figure out order of the chapters to not confuse with suddedenly appeared camera</em></p>
<p>There are various way to do parallax scrolling, but lets implement some simple hack to demonstrate the idea.</p>
<pre><code>    
// this (with magically appeared camera) simple formula will give us 0..1 value
// with 0 on left side of the level and 1 on the right 
let parallax_offset = level.camera / vec2(deset_rect.w, dest_rect.h);

// we can just draw the background layer slightly bigger than foreground
// to make some room to move it around
let mut dest_rect_parallax = Rect::new(
    -PARALLAX_EXTRA_W / 2.,
    -PARALLAX_EXTRA_H / 2., 
    dest_rect.w + PARALLAX_EXTRA_W / 2., 
    dest_rect.h + PARALLAX_EXTRA_H / 2.);
// and now shift it by our offset
dest_rect_parallax += parallax_offset;
    
self.tiled_map.draw_tiles(&quot;back&quot;, dest_rect_parallax, level.area);
self.tiled_map.draw_tiles(&quot;level&quot;, dest_rect, source_rect);
</code></pre>
<p>Now the background is moving slightly different than the foreground.</p>
<p><img src="https://i.imgur.com/kB7RjI5.gif" alt="parallax" /></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../intro.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../world/player-state-machine.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../intro.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../world/player-state-machine.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
